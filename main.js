(()=>{"use strict";var e=document.querySelector("#profile"),t=e.querySelector("#profile-name"),n=e.querySelector("#profile-about"),o=document.querySelector(".profile__title"),r=document.querySelector(".profile__subtitle"),c=document.querySelector("#newItem"),a=c.querySelector("#newItem-about"),u=c.querySelector("#newItem-name"),i=document.querySelector("#popupImage"),l=document.querySelector("#changeAvatar");function s(e){("Escape"===e.key||e.target.classList.contains("popup_opened"))&&m(document.querySelector(".popup_opened"))}function d(e){e.target.classList.contains("popup_opened")&&m(document.querySelector(".popup_opened"))}function p(e){var t=e.querySelector(".popup__button");t&&(t.textContent=t.dataset.text),e.classList.add("popup_opened"),document.addEventListener("keydown",s),e.addEventListener("mousedown",d)}function m(e){var t=e.querySelector(".popup__button");t&&(t.textContent="Сохранение..."),e.classList.remove("popup_opened"),document.removeEventListener("keydown",s),e.removeEventListener("mousedown",d)}document.querySelector(".elements");var f=document.querySelector("#element").content.querySelector(".elements__element"),v=popupImage.querySelector(".popup__image"),_=popupImage.querySelector(".popup__title");function h(e,t,n,o,r){var c=f.cloneNode(!0),a=c.querySelector(".elements__photo"),u=c.querySelector(".elements__like");a.src=e,a.alt="Фото "+t,c.querySelector(".elements__title").textContent=t,u.dataset.count=n,u.dataset.imageid=r,u.addEventListener("click",E);var i=c.querySelector(".elements__thrash");return o?(i.dataset.id=o,i.addEventListener("click",L)):i.remove(),a.addEventListener("click",(function(n){v.src=e,_.textContent=t,v.alt="Фото "+t,p(popupImage)})),c}var y="https://nomoreparties.co/v1/",S="450ae940-2b7e-4477-a632-282343b7d2dc",q="plus-cohort-16",g="";function L(e){var t=e.target.dataset.id;fetch(y+q+"/cards/"+t,{method:"DELETE",headers:{authorization:"".concat(S)}}).then((function(e){return e.json()})).then((function(t){e.target.closest(".elements__element").remove(),console.log(t)})).catch((function(e){console.log(e)}))}function E(e){var t,n=e.target.dataset.imageid,o=y+q+"/cards/likes/"+n;t=e.target.classList.contains("elements__like_active")?"DELETE":"PUT",fetch(o,{method:"".concat(t),headers:{authorization:"".concat(S)}}).then((function(e){return e.json()})).then((function(t){e.target.dataset.count=t.likes.length,e.target.classList.toggle("elements__like_active"),console.log(t)})).catch((function(e){console.log(e)}))}fetch("https://nomoreparties.co/v1/plus-cohort-16/users/me",{method:"GET",headers:{authorization:"".concat(S)}}).then((function(e){return e.json()})).then((function(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__subtitle"),o=document.querySelector(".profile__avatar");t.textContent=e.name,n.textContent=e.about,o.src=e.avatar,g=e._id})).catch((function(e){console.log(e)})),fetch("https://nomoreparties.co/v1/plus-cohort-16/cards",{method:"GET",headers:{authorization:"".concat(S)}}).then((function(e){return e.json()})).then((function(e){var t=document.querySelector(".elements");console.log(e);var n="";e.forEach((function(e){n=e.owner._id===g?e._id:"";var o=h(e.link,e.name,e.likes.length,n,e._id);e.likes.some((function(e){return e._id===g}))&&o.querySelector(".elements__like").classList.toggle("elements__like_active"),t.append(o)}))})).catch((function(e){console.log(e)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){t.value=o.textContent,n.value=r.textContent,p(e)})),e.querySelector(".popup__close-button").addEventListener("click",(function(){m(e)})),e.querySelector("#form-profile").addEventListener("submit",(function(c){var a,u;c.preventDefault(),a=t.value,u=n.value,fetch(y+q+"/users/me",{method:"PATCH",headers:{authorization:"".concat(S),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(a),about:"".concat(u)})}).then((function(e){return e.json()})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),o.textContent=t.value,r.textContent=n.value,m(e)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){p(c)})),c.querySelector(".popup__close-button").addEventListener("click",(function(){m(c)})),document.querySelector(".profile__image-block").addEventListener("click",(function(){p(l)})),l.querySelector(".popup__close-button").addEventListener("click",(function(){m(l)})),l.querySelector("#form-changeAvatar").addEventListener("submit",(function(e){var t;e.preventDefault(),t=l.querySelector("#changeAvatar-about").value,fetch(y+q+"/users/me/avatar",{method:"PATCH",headers:{authorization:"".concat(S),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(e){return e.json()})).then((function(e){document.querySelector(".profile__avatar").src=t,console.log(e)})).catch((function(e){console.log(e)})),m(l),e.target.reset()})),c.querySelector("#form-newItem").addEventListener("submit",(function(e){var t,n;e.preventDefault(),t=a.value,n=u.value,fetch(y+q+"/cards",{method:"POST",headers:{authorization:"".concat(S),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n),link:"".concat(t)})}).then((function(e){return e.json()})).then((function(e){var t=e._id,n=document.querySelector(".elements"),o=h(e.link,e.name,"0",t,t);n.prepend(o),console.log(e)})).catch((function(e){console.log(e)})),m(c),e.target.reset()})),i.querySelector(".popup__close-button").addEventListener("click",(function(){m(i)})),function(e){var t=e.formSelector,n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,c=e.inputErrorClass,a=e.errorClass;function u(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r),t.disabled=!1):(t.classList.add(r),t.disabled=!0)}Array.from(document.querySelectorAll(t)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(n)),r=e.querySelector(o);u(t,r),e.addEventListener("reset",(function(){setTimeout((function(){u(t,r)}),0)})),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(c),n.classList.remove(a),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(c),o.textContent=n,o.classList.add(a)}(e,t,t.validationMessage)})(e,n),u(t,r)}))}))}(e)}))}({formSelector:".form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"})})();